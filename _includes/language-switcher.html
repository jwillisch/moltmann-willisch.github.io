{% assign current_lang = page.lang | default: site.default_lang %}
{% assign current_page = page.url %}

<div class="language-switcher">
  {% for lang in site.languages %}
    {% if lang == current_lang %}
      <span class="lang-active">{{ lang | upcase }}</span>
    {% else %}
      {% capture page_url %}
        {% if lang == site.default_lang %}
          {{ current_page }}
        {% else %}
          /{{ lang }}{{ current_page }}
        {% endif %}
      {% endcapture %}
      <a href="{{ page_url | relative_url }}" class="lang-link">{{ lang | upcase }}</a>
    {% endif %}
    {% unless forloop.last %} | {% endunless %}
  {% endfor %}
</div>